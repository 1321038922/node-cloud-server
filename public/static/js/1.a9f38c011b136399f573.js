webpackJsonp([1],{"0iTH":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i("3f40"),i("4qOc"),i("+cgv");var n={props:{options:{type:Array},value:String},data:function(){return{currentValue:this.value}},watch:{value:function(t){this.currentValue=t},currentValue:function(t){this.$emit("input",t),this.$emit("change",t)}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"radios"},t._l(t.options,function(e){return i("label",{key:e._id,staticClass:"radios-label fll"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentValue,expression:"currentValue"}],staticClass:"radios-item",attrs:{type:"radio"},domProps:{value:e._id,checked:t._q(t.currentValue,e._id)},on:{change:function(i){t.currentValue=e._id}}}),t._v(" "),i("div",{staticClass:"radios-title-warp"},[i("span",{staticClass:"radios-title"},[t._v(t._s(e.name))])])])}))},staticRenderFns:[]};var o=i("VU/8")(n,a,!1,function(t){i("7b1U")},"data-v-5c34fd9e",null).exports,r=i("G0J2");const s={watcher:{},active:null,on:function(t,e){this.watcher[t]||(this.watcher[t]=e)},emit:function(t,e=1){this.active=this.watcher[t],1===e&&function(){let t=document.querySelector(".quill-image-input");null===t&&((t=document.createElement("input")).setAttribute("type","file"),t.classList.add("quill-image-input"),t.style.display="none",t.addEventListener("change",function(){let e=s.active;e.file=t.files[0],t.value="",e.config.size&&e.file.size>=1024*e.config.size*1024?e.config.sizeError&&e.config.sizeError():e.config.action?e.uploadImg():e.toBase64()}),document.body.appendChild(t));t.click()}()}};const l=[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]];r.Quill.register("modules/ImageExtend",class{constructor(t,e={}){this.id=Math.random(),this.quill=t,this.quill.id=this.id,this.config=e,this.file="",this.imgURL="",t.root.addEventListener("paste",this.pasteHandle.bind(this),!1),t.root.addEventListener("drop",this.dropHandle.bind(this),!1),t.root.addEventListener("dropover",function(t){t.preventDefault()},!1),this.cursorIndex=0,s.on(this.id,this)}pasteHandle(t){s.emit(this.quill.id,0);let e,i,n,a=t.clipboardData,o=0;if(a){if(!(e=a.items))return;for(i=e[0],n=a.types||[];o<n.length;o++)if("Files"===n[o]){i=e[o];break}if(i&&"file"===i.kind&&i.type.match(/^image\//i)){this.file=i.getAsFile();let t=this;if(t.config.size&&t.file.size>=1024*t.config.size*1024)return void(t.config.sizeError&&t.config.sizeError());this.config.action}}}dropHandle(t){s.emit(this.quill.id,0);const e=this;t.preventDefault(),e.config.size&&e.file.size>=1024*e.config.size*1024?e.config.sizeError&&e.config.sizeError():(e.file=t.dataTransfer.files[0],this.config.action?e.uploadImg():e.toBase64())}toBase64(){const t=this,e=new FileReader;e.onload=(e=>{t.imgURL=e.target.result,t.insertImg()}),e.readAsDataURL(t.file)}uploadImg(){const t=this;t.quillLoading;let e=t.config,i=new FormData;i.append(e.name,t.file),e.editForm&&e.editForm(i);let n=new XMLHttpRequest;n.open("post",e.action,!0),e.headers&&e.headers(n),e.change&&e.change(n,i),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){let i=JSON.parse(n.responseText);t.imgURL=e.response(i),s.active.uploadSuccess(),t.insertImg(),t.config.success&&t.config.success()}else t.config.error&&t.config.error(),s.active.uploadError()},n.upload.onloadstart=function(t){s.active.uploading(),e.start&&e.start()},n.upload.onprogress=function(t){let e=(t.loaded/t.total*100|0)+"%";s.active.progress(e)},n.upload.onerror=function(t){s.active.uploadError(),e.error&&e.error()},n.upload.onloadend=function(t){e.end&&e.end()},n.send(i)}insertImg(){const t=s.active;t.quill.insertEmbed(s.active.cursorIndex,"image",t.imgURL),t.quill.update(),t.quill.setSelection(t.cursorIndex+1)}progress(t){t="[uploading"+t+"]",s.active.quill.root.innerHTML=s.active.quill.root.innerHTML.replace(/\[uploading.*?\]/,t)}uploading(){let t=(s.active.quill.getSelection()||{}).index||s.active.quill.getLength();s.active.cursorIndex=t,s.active.quill.insertText(s.active.cursorIndex,"[uploading...]",{color:"red"},!0)}uploadError(){s.active.quill.root.innerHTML=s.active.quill.root.innerHTML.replace(/\[uploading.*?\]/,"[upload error]")}uploadSuccess(){s.active.quill.root.innerHTML=s.active.quill.root.innerHTML.replace(/\[uploading.*?\]/,"")}});var c={data:function(){return{formData:{content:"",title:"",contentText:"",category:""},categories:[],editorOption:{modules:{ImageExtend:{loading:!0,name:"img",action:"https://qiniu.com",response:function(t){return t.info}},toolbar:{container:l,handlers:{image:function(){s.emit(this.quill.id)}}}}}}},methods:{handleChange:function(t){t.quill,t.html;var e=t.text;this.formData.contentText=e,this.formData.contentText=this.formData.contentText.substring(0,200)+"..."},getCategory:function(){var t=this;this.$axios.get("/category").then(function(e){t.categories=e.data})},handleSubmit:function(){var t=this;console.log(this.formData),this.$axios.post("/article",this.formData).then(function(e){200==e.code?(t.$message.success("发布成功"),setTimeout(function(){t.$router.push("/index")},1e3)):(t.$message.error(e.msg),t.$router.push("/index"))}).catch(function(e){t.$message.error(res.msg)})}},created:function(){this.getCategory()},components:{quillEditor:r.quillEditor,radios:o}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"write-note"},[i("div",{staticClass:"main-content w1170"},[i("div",{staticClass:"title"},[t._v("\n            标题\n        ")]),t._v(" "),i("div",{staticClass:"input-wrap"},[i("el-input",{model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),t._v(" "),i("div",{staticClass:"title"},[t._v("\n            内容\n        ")]),t._v(" "),i("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{change:t.handleChange},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}}),t._v(" "),i("div",{staticClass:"category"},[i("div",{staticClass:"cleanfix"},[i("span",{staticClass:"fll"},[t._v(" 分类：")]),t._v(" "),i("span",{staticClass:"fll"},[i("radios",{attrs:{options:t.categories},model:{value:t.formData.category,callback:function(e){t.$set(t.formData,"category",e)},expression:"formData.category"}})],1)])]),t._v(" "),i("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("发布笔记")])],1)])},staticRenderFns:[]};var d=i("VU/8")(c,u,!1,function(t){i("Y86l"),i("dhta")},"data-v-26af0380",null);e.default=d.exports},"7b1U":function(t,e){},Y86l:function(t,e){},dhta:function(t,e){}});
//# sourceMappingURL=1.a9f38c011b136399f573.js.map